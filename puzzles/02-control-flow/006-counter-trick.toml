[metadata]
id = "flow-006"
title = "Counter Manipulation"
difficulty = 3
category = "control-flow"
tags = ["counter", "register", "advanced"]
estimated_time_minutes = 12
prerequisites = ["flow-002"]

[description]
brief = "Manipulate the counter to exit the loop early"
detailed = """
This program loops 100 times, incrementing EAX each time.
After the loop, it checks if EAX equals 100.

The problem: The loop will take a LONG time to execute!

You have several options:
1. Change the loop counter (starts at 100 in ECX)
2. Change the increment (currently ADD EAX, 1)
3. Change the comparison value (currently 100)
4. Skip the loop entirely

Can you make it pass without waiting for 100 iterations?
"""

[setup]
memory_size = 16384
code_start = 0x1000
data_start = 0x2000
stack_start = 0x3000

[setup.registers]
eax = 0
ecx = 100
esp = 0x3000

[setup.code]
# Assembly:
#   0x1000: xor eax, eax         ; 31 C0 - Clear counter
#   0x1002: loop_start:          ;
#   0x1002: add eax, 1           ; 83 C0 01 - Increment
#   0x1005: loop loop_start      ; E2 FB - Decrement ECX, loop if != 0
#   0x1007: cmp eax, 100         ; 83 F8 64 - Check if 100
#   0x100A: je success           ; 74 07
#   0x100C: mov eax, 0           ; B8 00 00 00 00 - Failure
#   0x1011: jmp end              ; EB 05
#   0x1013: success: mov eax, 1  ; B8 01 00 00 00 - Success
#   0x1018: end: hlt             ; F4
bytes = "31 C0 83 C0 01 E2 FB 83 F8 64 74 07 B8 00 00 00 00 EB 05 B8 01 00 00 00 F4"
entry_point = 0

[validation]
type = "register_value"
register = "eax"
expected = 1

[hints]
level1 = "The loop runs 100 times. Can you change the increment or skip the loop?"
level2 = "Change ADD EAX, 1 to ADD EAX, 100 to do it in one iteration!"
level3 = "Patch 0x1003 (the 01 in ADD EAX, 1) to 64: patch 0x1003 64"
