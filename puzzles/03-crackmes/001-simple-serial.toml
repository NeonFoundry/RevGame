[metadata]
id = "crack-001"
title = "Simple Serial"
difficulty = 3
category = "crackme"
tags = ["serial", "xor", "analysis"]
estimated_time_minutes = 15
prerequisites = ["flow-002", "flow-004"]

[description]
brief = "Find the correct serial number"
detailed = """
This is your first crackme! The program checks if a "serial number"
in memory matches an expected value.

The check:
1. Load the serial from memory (at 0x2000)
2. XOR it with a key (0x55)
3. Compare with expected value (0x32)

To crack it, you need to find what serial value will pass the check.
Remember: XOR is reversible! If A XOR B = C, then C XOR B = A.

What value XORed with 0x55 gives 0x32?
"""

[setup]
memory_size = 16384
code_start = 0x1000
data_start = 0x2000
stack_start = 0x3000

[setup.registers]
eax = 0
esp = 0x3000

[setup.code]
# Assembly:
#   0x1000: mov al, [0x2000]     ; A0 00 20 00 00 - Load serial byte
#   0x1005: xor al, 0x55         ; 34 55 - XOR with key
#   0x1007: cmp al, 0x32         ; 3C 32 - Compare with expected
#   0x1009: jne fail             ; 75 07 - Jump if wrong
#   0x100B: mov eax, 1           ; B8 01 00 00 00 - Success
#   0x1010: jmp end              ; EB 05
#   0x1012: fail: mov eax, 0     ; B8 00 00 00 00 - Failure
#   0x1017: end: hlt             ; F4
bytes = "A0 00 20 00 00 34 55 3C 32 75 07 B8 01 00 00 00 EB 05 B8 00 00 00 00 F4"
entry_point = 0

[setup.data]
# Serial at 0x2000 - starts with wrong value (0x00)
bytes = "00"

[validation]
type = "register_value"
register = "eax"
expected = 1

[hints]
level1 = "The serial is XORed with 0x55 and compared with 0x32. What's the math?"
level2 = "XOR property: if A XOR 0x55 = 0x32, then 0x32 XOR 0x55 = A"
level3 = "0x32 XOR 0x55 = 0x67. Patch the serial: patch 0x2000 67"
